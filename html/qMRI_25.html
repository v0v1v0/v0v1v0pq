<div class="container">

<table style="width: 100%;"><tr>
<td>smoothIRSolid</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Smooth object generated by function <code>estimateIRsolid</code>
</h2>

<h3>Description</h3>

<p>Adaptive smoothing of Rx and Sx maps over WM and GM areas.
</p>


<h3>Usage</h3>

<pre><code class="language-R">smoothIRSolid(IRmixedobj, kstar = 24, patchsize = 1, alpha = 0.025,
                   mscbw = 5, bysegment=TRUE, partial=TRUE, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>IRmixedobj</code></td>
<td>

<p>object of class <code>IRmixed</code> generated by function <code>estimateIRsolid</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kstar</code></td>
<td>

<p>number of steps for AWS algorithm
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>patchsize</code></td>
<td>

<p>patchsize in paws
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>significance level for decisions in aws algorithm (suggestion: between 1e-5 and 0.025)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mscbw</code></td>
<td>

<p>bandwidth for 3D median smoother used to stabilize the covariance estimates.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bysegment</code></td>
<td>

<p><code>TRUE</code>: restrict smoothing to segments from segmentation, <code>FALSE</code>: restrict smoothing to solid mask.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partial</code></td>
<td>

<p><code>TRUE</code>: ignore information concerning parameter <code>fx</code> when smoothing.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>logical: Monitor process.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This uses a vectorized version of the AWS algorithm that emloys inverse covariance estimates of the estimated parameters. Local smoothing is done for Rx and Sx maps in ergs which can be assumed to be locally smooth within tissue. No smoothing for fx maps since they may vary.
</p>


<h3>Value</h3>

<p>an object of class <code>"IRmixed"</code>, but with components Sx and Rx replaced. The object carries an additional component <code>bi</code> containing an array of sum of weights characterizing the amount of smoothing.
</p>


<h3>Author(s)</h3>

<p>Karsten Tabelow <a href="mailto:tabelow@wias-berlin.de">tabelow@wias-berlin.de</a><br>
J\"org Polzehl <a href="mailto:polzehl@wias-berlin.de">polzehl@wias-berlin.de</a>
</p>


<h3>References</h3>

<p>J. Polzehl and K. Tabelow (2023), Magnetic Resonance Brain Imaging:
Modeling and Data Analysis Using R, 2nd Edition, Chapter 7, Springer, Use R! Series.
&lt;doi:10.1007/978-3-031-38949-8_7&gt;.
</p>
<p>J. Polzehl and K. Tabelow (2023), Magnetic Resonance Brain Imaging - 
Modeling and Data Analysis Using R: Code and Data.
&lt;doi:10.20347/WIAS.DATA.6&gt;.
</p>


<h3>See Also</h3>

<p><code>estimateIRfluid</code>, <code>estimateIRsolid</code>, <code>estimateIRsolidfixed</code>,<code>estimateIR</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## runs about 10 seconds
dataDir0 &lt;- system.file("extdataIR", package = "qMRI")
dataDir &lt;- tempdir("IRdata")
library(oro.nifti)
library(qMRI)
segm &lt;- readNIfTI(file.path(dataDir0,"Brainweb_segm"))
Sf &lt;- 900
Rf &lt;- 0.000285
Sgm &lt;- 400
Rgm &lt;- 0.00075
fgm &lt;- .15
Swm &lt;- 370
Rwm &lt;- 0.0011
fwm &lt;- .05
InvTimes0 &lt;- c(100, 200, 400, 600, 800, 1200, 1600, 2000, 2500, 3000, 
              3500, 4000, 4500, 5000, 6000, 15000)
nTimes &lt;- length(InvTimes0)
sigma &lt;- 40
## generate IR signal
IRdata &lt;- generateIRData(segm, c(Sf,Rf), c(fgm,Rgm,Sgm), c(fwm,Rwm,Swm), InvTimes0, sigma)
for(i in 1:9) writeNIfTI(as.nifti(IRdata[i,,,]), 
                         file.path(dataDir,paste0("IR0",i)))
for(i in 10:nTimes) writeNIfTI(as.nifti(IRdata[i,,,]), 
                         file.path(dataDir,paste0("IR",i)))
## generate IRdata object
t1Files &lt;- list.files(dataDir,"*.nii.gz",full.names=TRUE)
segmFile &lt;- file.path(dataDir0,"Brainweb_segm")
IRdata &lt;- readIRData(t1Files, InvTimes0, segmFile, sigma=sigma,
                     L=1, segmCodes=c("CSF","GM","WM"))
## estimate fluid
setCores(2) # parallel mode using 2 threads
IRfluid &lt;- estimateIRfluid(IRdata, method="NLR", verbose=FALSE)
cat("Estimated parameters Sf:", IRfluid$Sf, 
                        " Rf:", IRfluid$Rf, "\n")
## estimate solid
IRmix &lt;- estimateIRsolid(IRfluid, verbose=FALSE)
## smoothing 
sIRmix &lt;- smoothIRSolid(IRmix, alpha=1e-4, partial=FALSE, verbose=FALSE)

</code></pre>


</div>