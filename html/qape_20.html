<div class="container">

<table style="width: 100%;"><tr>
<td>mcLMMmis</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Monte Carlo simuation study of accuracy of predictors under the misspecified model
</h2>

<h3>Description</h3>

<p>The function computes in the Monte Carlo simulation study values of accuracy measures of three predictors under the model assumed for one of them with possible modifications of covariance matrices of random effects and random components.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mcLMMmis(Ypop, predictorLMMmis, predictorLMM, predictorLMM2, K, p, ratioR, ratioG)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Ypop</code></td>
<td>
<p>population values of the variable of interest (already transformed if necessary) which are used as the dependent variable in the population model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predictorLMMmis</code></td>
<td>
<p>plugInLMM object, the predictor used to define the model assumed in the simulation study.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predictorLMM</code></td>
<td>
<p>plugInLMM object, the first predictor, the accuracy of which is assessed in the simulation study.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predictorLMM2</code></td>
<td>
<p>plugInLMM object, the second predictor, the accuracy of which is assessed in the simulation study.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>the number of Monte Carlo iterations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratioR</code></td>
<td>
<p>the value by which the diagonal elements of the covariance matrix of random components of the model based on the whole population data and formulation used in <em>predictorLMMmis</em> are divided. Then, the corrected covariance matrix is used to generate bootstrap realizations of random components.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratioG</code></td>
<td>
<p>the value by which the diagonal elements of the covariance matrix of random effects of the model based on the whole population data and formulation used in <em>predictorLMMmis</em> are divided. Then, the corrected covariance matrix, assuming that it is positive definite, is used to generate bootstrap realizations of random effects. If it is not positive definite, the alert is printed and the dependent variable is generated based on the model without random effects.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In the model-based simulation study population values of the dependent variable are generated based on the (possibly transformed) Linear Mixed Model used in <em>predictorLMMmis</em> with possibly modified covariance matrices of random effects and random components by the usage of <em>ratioR</em> and <em>ratioG</em> arguments. In the simulation study accuracy of predictors <em>predictorLMM</em> and <em>predictorLMM2</em> is assessed. Although, all the predictors are <em>plugInLMM</em> objects, it should be noted that under the non-transformed Linear Mixed Model and in the case of the prediction of the linear combination of the dependent variable (e.g. the mean, the total, and one realization of the variable), the predictors are Empirical Best Linear Unbiased Predictors. What is more, if <em>predictorLMMmis</em> is defined as <em>predictorLMM</em>, the Monte Carlo simulation study of accuracy of <em>predictorLMM</em> under correctly specified model and of <em>predictorLMM2</em> under misspecified model is conducted.      
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>errorLMM</code></td>
<td>
<p>Monte Carlo prediction errors of <em>predictorLMM</em> - number of rows is equal to the number of predicted characteristics (declared in <em>thetaFun</em>), number of columns is equal to <em>K</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>errorLMM2</code></td>
<td>
<p>Monte Carlo prediction errors of <em>predictorLMM2</em> - number of rows is equal to the number of predicted characteristics (declared in <em>thetaFun</em>), number of columns is equal to <em>K</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QAPElmm</code></td>
<td>
<p>value/s of the QAPE of <em>predictorLMM</em> assessed in the Monte Carlo study - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RMSElmm</code></td>
<td>
<p>value/s of the RMSE of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rRMSElmm</code></td>
<td>
<p>value/s of the rRMSE (in percentages) of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rBlmm</code></td>
<td>
<p>value/s of the relative bias (in percentages) of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QAPElmm2</code></td>
<td>
<p>value/s of the QAPE of <em>predictorLMM2</em> assessed in the Monte Carlo study - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RMSElmm2</code></td>
<td>
<p>value/s of the RMSE of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rRMSElmm2</code></td>
<td>
<p>value/s of the rRMSE (in percentages) of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rBlmm2</code></td>
<td>
<p>value/s of the relative bias (in percentages) of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>positiveDefiniteEstG</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate Monte Carlo realizations of the dependent variable, is positive definite.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), 1221-1245.<br></p>
<p>2. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br></p>
<p>3. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br></p>


<h3>Examples</h3>

<pre><code class="language-R">
data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 

invData2018$investments &lt;- invData2018$investments/1000
attach(invData2018)
N &lt;- nrow(invData2018) # population size

con &lt;- rep(0,N) 
set.seed(123456)
con[sample(N,50)] &lt;- 1 # sample size equals 50

YS &lt;- log((investments[con == 1])) # log-transformed values
backTrans &lt;- function(x) {exp(x)} # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'
random.part2 &lt;- '(1|NUTS4type)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components
weights.mis &lt;- sqrt(newly_registered)

# Characteristics to be predicted:
# the population mean and the population total  
thetaFun &lt;- function(x) {c(mean(x), median(x))}

predictorLMMmis &lt;- plugInLMM(YS, fixed.part, random.part, reg,con,weights.mis,backTrans,thetaFun)
predictorLMMmis$thetaP

predictorLMM &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictorLMM$thetaP

predictorLMM2 &lt;- plugInLMM(YS, fixed.part, random.part2, reg, con, weights, backTrans, thetaFun)
predictorLMM2$thetaP

Ypop &lt;- log(invData2018$investments)

# Monte Carlo simulation study under the misspecified model defined in predictorLMMmis 
# with modified covariance matrices R and G
set.seed(123456)
mcLMMmis(Ypop, predictorLMMmis, predictorLMM, predictorLMM2, 5, c(0.75,0.9), 2, 0.1)

# Monte Carlo simulation study under the model defined in predictorLMM
# correctly specified for predictorLMM and misspecified for predictorLMM2
set.seed(123456)
mcLMMmis(Ypop, predictorLMM, predictorLMM, predictorLMM2, 5, c(0.75,0.9), 1, 1)

detach(invData2018)
</code></pre>


</div>