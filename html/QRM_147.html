<div class="container">

<table style="width: 100%;"><tr>
<td>POT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Peaks-over-Threshold Method
</h2>

<h3>Description</h3>

<p>Functions for fitting, analysing and risk measures according to POT/GPD
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit.GPD(data, threshold = NA, nextremes = NA, type = c("ml", "pwm"),
        information = c("observed", "expected"),
        optfunc = c("optim", "nlminb"), verbose = TRUE, ...)
plotTail(object, ppoints.gpd = ppoints(256), main = "Estimated tail probabilities",
         xlab = "Exceedances x", ylab = expression(1-hat(F)[n](x)), ...)
showRM(object, alpha, RM = c("VaR", "ES"),
       like.num = 64, ppoints.gpd = ppoints(256),
       xlab = "Exceedances x", ylab = expression(1-hat(F)[n](x)),
       legend.pos = "topright", pre.0.4.9=FALSE, ...)
findthreshold(data, ne)
MEplot(data, omit = 3., main = "Mean-Excess Plot", xlab = "Threshold",
       ylab = "Mean Excess", ...)
xiplot(data, models = 30., start = 15., end = 500., reverse = TRUE,
       ci = 0.95, auto.scale = TRUE, labels = TRUE, table = FALSE, ...)
hill(data, k, tail.index = TRUE)
hillPlot(data, option = c("alpha", "xi", "quantile"), start = 15,
         end = NA, reverse = FALSE, p = NA, ci = 0.95,
         auto.scale = TRUE, labels = TRUE, ...)
plotFittedGPDvsEmpiricalExcesses(data, threshold = NA, nextremes = NA)
RiskMeasures(out, p)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p><code>numeric</code>, probability level(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auto.scale</code></td>
<td>
<p><code>logical</code>, whether plot should be automatically
scaled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p><code>numeric</code>, probability for asymptotic confidence
bands.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p><code>numeric</code>, data vector or timesSeries.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end</code></td>
<td>
<p><code>integer</code>, maximum number of exceedances to be
considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>information</code></td>
<td>
<p><code>character</code>, whether standard errors should be
calculated with “observed” or “expected”
information. This only applies to maximum likelihood type; for
“pwm” type “expected” information is used if possible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>number (greater than or equal to 2) of order statistics used
to compute the Hill plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p><code>logical</code>, whether axes shall be labelled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.pos</code></td>
<td>
<p>if not <code>NULL</code>, position of
<code>legend()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pre.0.4.9</code></td>
<td>
<p><code>logical</code>, whether behavior previous to version
0.4-9 applies (returning the risk measure estimate and confidence
intervals instead of just <code>invisible()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>like.num</code></td>
<td>
<p><code>integer</code>, count of evaluations of profile likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main,xlab,ylab</code></td>
<td>
<p>title, x axis and y axis labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models</code></td>
<td>
<p><code>integer</code>, count of consecutive gpd models to be
fitted; <em>i.e.</em>, the count of different thresholds at which to
re-estimate <code class="reqn">\xi</code>; this many <code class="reqn">\xi</code> estimates will be
plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ne</code></td>
<td>
<p><code>integer</code>, count of excesses above the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nextremes</code></td>
<td>
<p><code>integer</code>, count of upper extremes to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p><code>list</code>, returned value from fitting GPD</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omit</code></td>
<td>
<p><code>integer</code>, count of upper plotting points to be
omitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optfunc</code></td>
<td>
<p><code>character</code>, function used for ML-optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><code>logical</code> indicating whether warnings are given;
currently only applies in the case where <code>type="pwm"</code> and
<code>xi &gt; 0.5</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>option</code></td>
<td>
<p><code>logical</code>, whether "alpha", "xi" (1 / alpha) or
"quantile" (a quantile estimate) should be plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out</code></td>
<td>
<p><code>list</code>, returned value from fitting GPD.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p><code>vector</code>, probability levels for risk measures.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppoints.gpd</code></td>
<td>
<p>points in (0,1) for evaluating the GPD tail estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reverse</code></td>
<td>
<p><code>logical</code>, plot ordered by increasing threshold
or number of extremes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RM</code></td>
<td>
<p><code>character</code>, risk measure, either "VaR" or "ES"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p><code>integer</code>, lowest number of exceedances to be
considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>table</code></td>
<td>
<p><code>logical</code>, printing of a result table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tail.index</code></td>
<td>
<p><code>logical</code> indicating whether the Hill estimator
of <code class="reqn">alpha</code> (the default) or <code class="reqn">1/alpha</code> is computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p><code>numeric</code>, threshold value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p><code>character</code>, estimation by either ML- or PWM type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>ellpsis, arguments are passed down to either <code>plot()</code>
or <code>optim()</code> or <code>nlminb()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>hillplot()</code>: This plot is usually calculated from the alpha
perspective. For a generalized Pareto analysis of heavy-tailed data
using the gpd function, it helps to plot the Hill estimates for
xi. See pages 286–289 in QRM. Especially note that Example 7.28
suggests the best estimates occur when the threshold is very small,
perhaps 0.1 of the sample size (10–50 order statistics in a sample of
size 1000).  Hence one should NOT be using a 95 percent threshold for
Hill estimates.<br><code>MEplot()</code>: An upward trend in plot shows heavy-tailed
behaviour. In particular, a straight line with positive gradient above
some threshold is a sign of Pareto behaviour in tail. A downward trend
shows thin-tailed behaviour whereas a line with zero gradient shows an
exponential tail. Because upper plotting points are the average of a
handful of extreme excesses, these may be omitted for a prettier
plot.<br><code>plotFittedGPDvsEmpiricalExcesses()</code>: Build a graph which plots
the GPD fit of excesses over a threshold u and the corresponding
empirical distribution function for observed excesses.<br><code>RiskMeasures()</code>: Calculates risk measures (VaR or ES) based on a
generalized Pareto model fitted to losses over a high threshold.<br><code>xiplot()</code>: Creates a plot showing how the estimate of shape
varies with threshold or number of extremes.
</p>


<h3>See Also</h3>

<p><code>GEV</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(danish)
plot(danish)

MEplot(danish)

xiplot(danish)

hillPlot(danish, option = "alpha", start = 5, end = 250, p = 0.99)
hillPlot(danish, option = "alpha", start = 5, end = 60, p = 0.99)

plotFittedGPDvsEmpiricalExcesses(danish, nextremes = 109)
u &lt;- quantile(danish, probs=0.9, names=FALSE)
plotFittedGPDvsEmpiricalExcesses(danish, threshold = u)

findthreshold(danish, 50)
mod1 &lt;- fit.GPD(danish, threshold = u)

RiskMeasures(mod1, c(0.95, 0.99))
plotTail(mod1)

showRM(mod1, alpha = 0.99, RM = "VaR", method = "BFGS")
showRM(mod1, alpha = 0.99, RM = "ES", method = "BFGS")

mod2 &lt;- fit.GPD(danish, threshold = u, type = "pwm")
mod3 &lt;- fit.GPD(danish, threshold = u, optfunc = "nlminb")

## Hill plot manually constructed based on hill()

## generate data
set.seed(1)
n &lt;- 1000 # sample size
U &lt;- runif(n)
X1 &lt;- 1/(1-U) # ~ F_1(x) = 1-x^{-1}, x &gt;= 1 =&gt; Par(1)
F2 &lt;- function(x) 1-(x*log(x))^(-1) # Par(1) with distorted SV function
X2 &lt;- vapply(U, function(u) uniroot(function(x) 1-(x*log(x))^(-1)-u,
                                    lower=1.75, upper=1e10)$root, NA_real_)

## compute Hill estimators for various k
k &lt;- 10:800
y1 &lt;- hill(X1, k=k)
y2 &lt;- hill(X2, k=k)

## Hill plot
plot(k, y1, type="l", ylim=range(y1, y2, 1),
     xlab=expression("Number"~~italic(k)~~"of upper order statistics"),
     ylab=expression("Hill estimator for"~~alpha),
     main="Hill plot") # Hill plot, good natured case (based on X1)
lines(k, y2, col="firebrick") # Hill "horror" plot (based on X2)
lines(x=c(10, 800), y=c(1, 1), col="royalblue3") # correct value alpha=1
legend("topleft", inset=0.01, lty=c(1, 1, 1), bty="n",
       col=c("black", "firebrick", "royalblue3"),
       legend=as.expression(c("Hill estimator based on"~~
                               italic(F)(x)==1-1/x,
                              "Hill estimator based on"~~
                               italic(F)(x)==1-1/(x~log~x),
                              "Correct value"~~alpha==1)))

## via hillPlot()
hillPlot(X1, option="alpha", start=10, end=800)
hillPlot(X2, option="alpha", start=10, end=800)
</code></pre>


</div>