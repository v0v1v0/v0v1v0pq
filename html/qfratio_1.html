<div class="container">

<table style="width: 100%;"><tr>
<td>qfratio-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>qfratio: Moments and Distributions of Ratios of Quadratic Forms</h2>

<h3>Description</h3>

<p>This package is for evaluating moments of ratios (and products) of quadratic
forms in normal variables, specifically using recursive algorithms developed
by Bao et al. (2013) and Hillier et al. (2014) (see also Smith, 1989, 1993;
Hillier et al., 2009).  It also provides some functions to evaluate
distribution, quantile, and probability density functions of simple ratios
of quadratic forms in normal variables using several algorithms.  It was
originally developed as a supplement to Watanabe (2023) for evaluating
average evolvability measures in evolutionary quantitative genetics,
but can be used for a broader class of statistics.
</p>


<h3>Details</h3>

<p>The primary front-end functions of this package are
<code>qfrm()</code> and <code>qfmrm()</code> for evaluating moments of
ratios of quadratic forms.  These pass arguments to one of the several
“internal” (though exported) functions which do actual calculations,
depending on the argument matrices and exponents.  In addition, there are
a few functions to calculate moments of products
of quadratic forms (integer exponents only; <code>qfpm</code>).
</p>
<p>There are many internal functions for calculating coefficients in
power-series expansion of generating functions for these moments
(<code>d1_i</code>, <code>d2_ij</code>, <code>d3_ijk</code>,
<code>dtil2_pq</code>) using “super-short” recursions
(Bao and Kan, 2013; Hillier et al. 2014).  Some of these coefficients are
related to the top-order zonal and invariant
polynomials of matrix arguments.
</p>
<p>The package also has some functions to evaluate distribution, quantile, and
density functions of simple ratios of quadratic forms: <code>pqfr()</code>,
<code>qqfr()</code>, and <code>dqfr()</code>.
</p>
<p>See package vignettes (<code>vignette("qfratio")</code> and
<code>vignette("qfratio_distr")</code>) for more details.
</p>
<p>The DESCRIPTION file:
</p>

<table>
<tr>
<td style="text-align: left;">
Package: </td>
<td style="text-align: left;"> qfratio</td>
</tr>
<tr>
<td style="text-align: left;">
Type: </td>
<td style="text-align: left;"> Package</td>
</tr>
<tr>
<td style="text-align: left;">
Title: </td>
<td style="text-align: left;"> Moments and Distributions of Ratios of Quadratic Forms Using Recursion</td>
</tr>
<tr>
<td style="text-align: left;">
Version: </td>
<td style="text-align: left;"> 1.1.1</td>
</tr>
<tr>
<td style="text-align: left;">
Date: </td>
<td style="text-align: left;"> 2024-02-08</td>
</tr>
<tr>
<td style="text-align: left;">
Authors@R: </td>
<td style="text-align: left;"> c(person("Junya", "Watanabe", email = "Junya.Watanabe@uab.cat",
                    role = c("aut", "cre", "cph"),
                    comment = c(ORCID = "0000-0002-9810-5286")),
             person("Patrick", "Alken", role = "cph",
                    comment = "Author of bundled C codes from GSL"),
             person("Brian", "Gough", role = "cph",
                    comment = "Author of bundled C codes from GSL"),
             person("Pavel", "Holoborodko", role = "cph",
                    comment = "Author of bundled C codes from GSL"),
             person("Gerard", "Jungman", role = "cph",
                    comment = "Author of bundled C codes from GSL"),
             person("Reid", "Priedhorsky", role = "cph",
                    comment = "Author of bundled C codes from GSL"),
             person("Free Software Foundation, Inc.", role = "cph",
                    comment = "Copyright holder of some bundled scripts"))</td>
</tr>
<tr>
<td style="text-align: left;">
Description: </td>
<td style="text-align: left;"> Evaluates moments of ratios (and products) of quadratic forms
    in normal variables, specifically using recursive algorithms developed by
    Bao and Kan (2013) &lt;doi:10.1016/j.jmva.2013.03.002&gt; and Hillier et al.
    (2014) &lt;doi:10.1017/S0266466613000364&gt;. Also provides distribution,
    quantile, and probability density functions of simple ratios of quadratic
    forms in normal variables with several algorithms. Originally developed as
    a supplement to Watanabe (2023) &lt;doi:10.1007/s00285-023-01930-8&gt; for
    evaluating average evolvability measures in evolutionary quantitative
    genetics, but can be used for a broader class of statistics. Generating 
    functions for these moments are also closely related to the top-order zonal
    and invariant polynomials of matrix arguments.</td>
</tr>
<tr>
<td style="text-align: left;">
License: </td>
<td style="text-align: left;"> GPL (&gt;= 3)</td>
</tr>
<tr>
<td style="text-align: left;">
URL: </td>
<td style="text-align: left;"> https://github.com/watanabe-j/qfratio</td>
</tr>
<tr>
<td style="text-align: left;">
BugReports: </td>
<td style="text-align: left;"> https://github.com/watanabe-j/qfratio/issues</td>
</tr>
<tr>
<td style="text-align: left;">
Imports: </td>
<td style="text-align: left;"> Rcpp, MASS, stats</td>
</tr>
<tr>
<td style="text-align: left;">
LinkingTo: </td>
<td style="text-align: left;"> Rcpp, RcppEigen</td>
</tr>
<tr>
<td style="text-align: left;">
Suggests: </td>
<td style="text-align: left;"> mvtnorm, CompQuadForm, graphics, testthat (&gt;= 3.0.0),
knitr, rmarkdown</td>
</tr>
<tr>
<td style="text-align: left;">
Encoding: </td>
<td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
<td style="text-align: left;">
Roxygen: </td>
<td style="text-align: left;"> list(markdown = TRUE)</td>
</tr>
<tr>
<td style="text-align: left;">
RoxygenNote: </td>
<td style="text-align: left;"> 7.2.3</td>
</tr>
<tr>
<td style="text-align: left;">
Config/testthat/edition: </td>
<td style="text-align: left;"> 3</td>
</tr>
<tr>
<td style="text-align: left;">
VignetteBuilder: </td>
<td style="text-align: left;"> knitr, rmarkdown</td>
</tr>
<tr>
<td style="text-align: left;">
Author: </td>
<td style="text-align: left;"> Junya Watanabe [aut, cre, cph]
    (&lt;https://orcid.org/0000-0002-9810-5286&gt;),
  Patrick Alken [cph] (Author of bundled C codes from GSL),
  Brian Gough [cph] (Author of bundled C codes from GSL),
  Pavel Holoborodko [cph] (Author of bundled C codes from GSL),
  Gerard Jungman [cph] (Author of bundled C codes from GSL),
  Reid Priedhorsky [cph] (Author of bundled C codes from GSL),
  Free Software Foundation, Inc. [cph] (Copyright holder of some bundled
    scripts)</td>
</tr>
<tr>
<td style="text-align: left;">
Maintainer: </td>
<td style="text-align: left;"> Junya Watanabe &lt;Junya.Watanabe@uab.cat&gt;</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>Index of help topics:
</p>
<pre>
KiK                     Matrix square root and generalized inverse
S_fromUL                Make covariance matrix from eigenstructure
a1_pk                   Recursion for a_{p,k}
d1_i                    Coefficients in polynomial expansion of
                        generating function-single matrix
d2_ij                   Coefficients in polynomial expansion of
                        generating function-for ratios with two
                        matrices
d3_ijk                  Coefficients in polynomial expansion of
                        generating function-for ratios with three
                        matrices
dqfr                    Probability distribution of ratio of quadratic
                        forms
dtil2_pq                Coefficients in polynomial expansion of
                        generating function-for products
hgs                     Calculate hypergeometric series
hyperg_1F1_vec_b        Internal C++ wrappers for GSL
is_diagonal             Is this matrix diagonal?
iseq                    Are these vectors equal?
new_qfrm                Construct qfrm object
p_A1B1_Ed               Internal C++ functions
print.qfrm              Methods for qfrm and qfpm objects
qfmrm                   Moment of multiple ratio of quadratic forms in
                        normal variables
qfpm                    Moment of (product of) quadratic forms in
                        normal variables
qfratio-package         qfratio: Moments and Distributions of Ratios of
                        Quadratic Forms
qfrm                    Moment of ratio of quadratic forms in normal
                        variables
range_qfr               Get range of ratio of quadratic forms
rqfr                    Monte Carlo sampling of ratio/product of
                        quadratic forms
sum_counterdiag         Summing up counter-diagonal elements
tr                      Matrix trace function
</pre>


<h3>Author/Maintainer</h3>

<p>Junya Watanabe <a href="mailto:Junya.Watanabe@uab.cat">Junya.Watanabe@uab.cat</a>
</p>


<h3>References</h3>

<p>Bao, Y. and Kan, R. (2013) On the moments of ratios of quadratic forms in
normal random variables. <em>Journal of Multivariate Analysis</em>, <strong>117</strong>,
229–245.
<a href="https://doi.org/10.1016/j.jmva.2013.03.002">doi:10.1016/j.jmva.2013.03.002</a>.
</p>
<p>Hillier, G., Kan, R. and Wang, X. (2009) Computationally efficient recursions
for top-order invariant polynomials with applications.
<em>Econometric Theory</em>, <strong>25</strong>, 211–242.
<a href="https://doi.org/10.1017/S0266466608090075">doi:10.1017/S0266466608090075</a>.
</p>
<p>Hillier, G., Kan, R. and Wang, X. (2014) Generating functions and
short recursions, with applications to the moments of quadratic forms
in noncentral normal vectors. <em>Econometric Theory</em>, <strong>30</strong>, 436–473.
<a href="https://doi.org/10.1017/S0266466613000364">doi:10.1017/S0266466613000364</a>.
</p>
<p>Smith, M. D. (1989) On the expectation of a ratio of quadratic forms
in normal variables. <em>Journal of Multivariate Analysis</em>, <strong>31</strong>, 244–257.
<a href="https://doi.org/10.1016/0047-259X%2889%2990065-1">doi:10.1016/0047-259X(89)90065-1</a>.
</p>
<p>Smith, M. D. (1993) Expectations of ratios of quadratic forms in normal
variables: evaluating some top-order invariant polynomials.
<em>Australian Journal of Statistics</em>, <strong>35</strong>, 271–282.
<a href="https://doi.org/10.1111/j.1467-842X.1993.tb01335.x">doi:10.1111/j.1467-842X.1993.tb01335.x</a>.
</p>
<p>Watanabe, J. (2023) Exact expressions and numerical evaluation of average
evolvability measures for characterizing and comparing <strong>G</strong> matrices.
<em>Journal of Mathematical Biology</em>, <strong>86</strong>, 95.
<a href="https://doi.org/10.1007/s00285-023-01930-8">doi:10.1007/s00285-023-01930-8</a>.
</p>


<h3>See Also</h3>

<p><code>qfrm</code>: Moment of simple ratio of quadratic forms
</p>
<p><code>qfmrm</code>: Moment of multiple ratio of quadratic forms
</p>
<p><code>qfpm</code>: Moment of product of quadratic forms
</p>
<p><code>rqfr</code>: Monte Carlo sampling of ratio/product of
quadratic forms
</p>
<p><code>dqfr</code>: Probability distribution of simple ratio of
quadratic forms
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Symmetric matrices
nv &lt;- 4
A &lt;- diag(nv:1)
B &lt;- diag(sqrt(1:nv))
D &lt;- diag((1:nv)^2 / nv)
mu &lt;- nv:1 / nv
Sigma &lt;- matrix(0.5, nv, nv)
diag(Sigma) &lt;- 1

## Expectation of (x^T A x)^2 / (x^T x)^2 where x ~ N(0, I)
qfrm(A, p = 2)
## And a Monte Carlo mean of the same
mean(rqfr(1000, A = A, p = 2))

## Expectation of (x^T A x)^1/2 / (x^T x)^1/2 where x ~ N(0, I)
(res1 &lt;- qfrm(A, p = 1/2))
plot(res1)
## A Monte Carlo mean
mean(rqfr(1000, A = A, p = 1/2))

## (x^T A x)^2 / (x^T B x)^3 where x ~ N(mu, Sigma)
(res2 &lt;- qfrm(A, B, p = 2, q = 3, mu = mu, Sigma = Sigma))
plot(res2)
## A Monte Carlo mean
mean(rqfr(1000, A = A, B = B, p = 2, q = 3, mu = mu, Sigma = Sigma))

## Expectation of (x^T A x)^2 / (x^T B x) (x^T x) where x ~ N(0, I)
(res3 &lt;- qfmrm(A, B, p = 2, q = 1, r = 1))
plot(res3)
## A Monte Carlo mean
mean(rqfmr(1000, A = A, B = B, p = 2, q = 1, r = 1))

## Expectation of (x^T A x)^2 where x ~ N(0, I)
qfm_Ap_int(A, 2)
## A Monte Carlo mean
mean(rqfp(1000, A = A, p = 2, q = 0, r = 0))

## Expectation of (x^T A x) (x^T B x) (x^T D x) where x ~ N(mu, I)
qfpm_ABDpqr_int(A, B, D, 1, 1, 1, mu = mu)
## A Monte Carlo mean
mean(rqfp(1000, A = A, B = B, D = D, p = 1, q = 1, r = 1, mu = mu))

## Distribution and quantile functions,
## and density of (x^T A x) / (x^T B x)
quantiles &lt;- 0:nv + 0.5
(probs &lt;- pqfr(quantiles, A, B))
qqfr(probs, A, B)     # p = 1 yields maximum of ratio
dqfr(quantiles, A, B)

</code></pre>


</div>